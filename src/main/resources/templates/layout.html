<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:hx="http://www.w3.org/1999/xhtml"
      th:fragment="layout(title, content)"
      th:data-theme="${theme ?: 'light'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title} + ' - Career Competency Matrix'">Career Competency Matrix</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
</head>
<body>
    <header class="container">
        <nav>
            <ul>
                <li><a th:href="@{/}" class="brand"><strong>Competency Matrix</strong></a></li>
            </ul>
            <ul>
                <li>
                    <button hx:post="@{/theme}"
                            hx-swap="none"
                            hx-on::after-request="toggleTheme()"
                            class="outline secondary"
                            id="theme-toggle">
                        <span th:if="${theme == 'dark'}">Light Mode</span>
                        <span th:unless="${theme == 'dark'}">Dark Mode</span>
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <th:block th:replace="${content}" />
    </main>

    <footer class="container">
        <hr>
        <p><small>Career Competency Matrix - A tool for visualizing career skill requirements</small></p>
    </footer>

    <dialog id="skill-modal">
        <article id="skill-modal-content">
        </article>
    </dialog>

    <script th:inline="javascript">
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);

            const btn = document.getElementById('theme-toggle');
            btn.innerHTML = newTheme === 'dark' ? 'Light Mode' : 'Dark Mode';
        }

        function openSkillModal() {
            const modal = document.getElementById('skill-modal');
            modal.showModal();
        }

        function closeSkillModal() {
            const modal = document.getElementById('skill-modal');
            modal.close();
        }

        document.addEventListener('htmx:afterSwap', function(evt) {
            if (evt.detail.target.id === 'skill-modal-content') {
                openSkillModal();
            }
        });

        document.getElementById('skill-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSkillModal();
            }
        });
    </script>
</body>
</html>
